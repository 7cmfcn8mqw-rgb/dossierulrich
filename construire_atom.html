<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Construire un atome</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7ff;
      color: #222;
    }

    h1 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 0.95rem;
      margin-bottom: 14px;
    }

    .toggle-row {
      text-align: center;
      margin-bottom: 14px;
      font-size: 0.95rem;
    }

    .sim {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      align-items: flex-start;
    }

    /* --- zone atome --- */
    .atom-area {
      position: relative;
      width: 360px;
      height: 360px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
    }

    .nucleus {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #f6d2a0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #222;
      z-index: 2;
    }

    .orbit {
      position: absolute;
      border-radius: 50%;
      border: 2px dashed #235de8;
      pointer-events: none;
    }

    .orbit-1 { width: 120px; height: 120px; }
    .orbit-2 { width: 210px; height: 210px; }
    .orbit-3 { width: 300px; height: 300px; }

    .orbit-1, .orbit-2, .orbit-3 {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .highlight {
      border: 4px solid #ffd400 !important;
      box-shadow: 0 0 12px rgba(255, 212, 0, 0.9);
    }

    #electron-layer,
    #orbital-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .electron {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00a050;
      box-shadow: 0 0 4px rgba(0,0,0,0.35);
    }

    .orbital-square {
      position: absolute;
      width: 28px;
      height: 28px;
      border: 2px solid #000;
      border-radius: 4px;
      background: rgba(0,153,68,0.08);
    }

    .outer-info {
      position: absolute;
      left: 100%;
      margin-left: 12px;
      bottom: 20px;
      background: #fffbe6;
      border: 2px solid #ffd400;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 0.85rem;
      box-shadow: 0 0 8px rgba(0,0,0,0.15);
      display: none;
      min-width: 170px;
    }

    .outer-info-title {
      font-weight: 700;
      margin-bottom: 4px;
    }

    /* --- zone de droite --- */

    .right-panel {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 20px;
    }

    .baskets {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .basket-label {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .basket-label span { display:inline-block; }

    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      margin-top: 2px;
    }

    .controls button {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: none;
      background: #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.18);
      cursor: pointer;
      font-size: 16px;
    }

    .controls span {
      display: inline-block;
      width: 28px;
      text-align: center;
      font-size: 1rem;
    }

    .basket-extra {
      text-align: center;
      font-size: 1rem;
      margin-top: 4px;
    }

    .basket-separator {
      height: 16px;
    }

    /* panneau infos */

    .infos {
      padding: 8px 12px;
      background: #f0f0ff;
      border-radius: 12px;
      box-shadow: 0 0 6px rgba(0,0,0,0.12);
      font-size: 0.95rem;
    }

    
    .version-tag {
      position: absolute;
      left: 14px;
      bottom: 14px;
      padding: 8px 14px;
      border-radius: 18px;
      border: 1px solid #b0b0b0;
      background: #ffffff;
      font-size: 0.9rem;
      box-shadow: 0 8px 18px rgba(0,0,0,0.18);
    }

    .info-grid {
      display: inline-grid;
      grid-template-columns: auto auto;
      gap: 4px 12px;
      text-align: left;
    }

    /* --- mode noyau (boules) --- */
    .nucleus.mode-balls{
      width: 96px;
      height: 96px;
      font-size: 0;
      background: transparent;
    }
    #nucleon-layer{
      position:absolute;
      inset:0;
      border-radius:50%;
      overflow:hidden;
      pointer-events:none;
      display:none;
    }
    .nucleon{
      position:absolute;
      width: 4px;
      height: 4px;
      border-radius:50%;
      box-shadow: 0 0 2px rgba(0,0,0,0.35);
    }
    .nucleon.p{ background:#d62828; }
    .nucleon.n{ background:#1d4ed8; }

    /* vibration légère du noyau (uniquement quand "noyau peu stable") */
    .nucleus.vibrate{
      animation: nucleusVibe 0.14s infinite alternate;
    }
    @keyframes nucleusVibe{
      from{ transform: translate(-1px, -1px); }
      to  { transform: translate( 1px,  1px); }
    }
  </style>
<style>
/* Added by script: small top-left home button */
.home-btn{
  position:fixed;
  top:8px;
  left:8px;
  width:22px;
  height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-decoration:none;
  font-size:14px;
  line-height:1;
  border-radius:6px;
  background:rgba(255,255,255,0.8);
  color:#111;
  border:1px solid rgba(0,0,0,0.25);
  box-shadow:0 1px 3px rgba(0,0,0,0.15);
  z-index:2147483647;
}
.home-btn:hover{ background:rgba(255,255,255,0.95); }
.home-btn:active{ transform:translateY(1px); }
@media (prefers-color-scheme: dark){
  .home-btn{
    background:rgba(30,30,30,0.75);
    color:#f5f5f5;
    border:1px solid rgba(255,255,255,0.25);
  }
}

</style>
</head>
<body>
<a href="https://7cmfcn8mqw-rgb.github.io/dossierulrich/" class="home-btn" aria-label="Retour au menu principal" title="Menu">⟵</a>

<div class="version-tag">
  <div>Version 2.0</div>
  <div>ECG Henry-Dunant</div>
  <div>Serge Ulrich</div>
</div>

<h1>Construire un atome</h1>
<div class="subtitle">Modèle de Bohr simplifié</div>

<div class="toggle-row">
  <label><input type="checkbox" id="toggle-orbitals"> Afficher les orbitales</label>
  <span id="outer-toggle-wrapper" style="display:none; margin-left: 20px;">
    <label><input type="checkbox" id="toggle-outer"> Mettre en évidence la couche externe</label>
  </span>
  <span style="margin-left: 20px;">
    <label><input type="checkbox" id="toggle-isotope"> Afficher l'isotope</label>
  </span>
  <span style="margin-left: 20px;">
    <label><input type="checkbox" id="toggle-nucleus-mode"> Mode noyau</label>
  </span>
</div>

<div class="sim">
  <div class="atom-area">
    <div id="outer-info" class="outer-info">
      <div class="outer-info-title">Couche externe</div>
      <div>Célibataires : <span id="single-count">0</span></div>
      <div>Paires : <span id="pair-count">0</span></div>
      <div id="outer-complete-text" style="margin-top:4px;font-weight:600;"></div>
      <div id="outer-error-text" style="margin-top:2px;font-size:0.8rem;color:#b00020;"></div>
    </div>

    <div class="nucleus" id="nucleus">
      <div id="nucleus-text" style="text-align:center;line-height:1.3;">
        <span style="color:red;">p⁺: <span id="p-core">1</span></span><br>
        <span id="n-core-wrapper" style="color:blue;display:none;">n: <span id="n-core">0</span></span>
      </div>
      <div id="nucleon-layer" aria-hidden="true"></div>
    </div>

    <div class="orbit orbit-1" id="shell1"></div>
    <div class="orbit orbit-2" id="shell2"></div>
    <div class="orbit orbit-3" id="shell3"></div>

    <div id="orbital-layer"></div>
    <div id="electron-layer"></div>
  </div>

  <div class="right-panel">

    <div class="baskets">

      <div class="basket protons">
        <div class="basket-label">
          <span style="color:red;">Protons</span>
        </div>
        <div class="controls">
          <button id="p-minus">−</button>
          <span id="p-value">1</span>
          <button id="p-plus">+</button>
        </div>
        <div class="basket-extra" style="display:none;">
          <span style="color:red;">Nombre de protons</span> : <span id="p-count-left">1</span>
        </div>
        <div class="basket-separator"></div>
      </div>

      <div class="basket neutrons" id="neutron-basket">
        <div class="basket-label">
          <span style="color:blue;">Neutrons</span>
        </div>
        <div class="controls">
          <button id="n-minus">−</button>
          <span id="n-value">0</span>
          <button id="n-plus">+</button>
        </div>
        <div id="neutron-extra" class="basket-extra" style="display:none;">
          <span style="color:blue;">Nombre de neutrons</span> : <span id="n-count-left">0</span>
        </div>
        <div class="basket-separator"></div>
      </div>

      <div class="basket electrons">
        <div class="basket-label">
          <span style="color:green;">Électrons</span>
        </div>
        <div class="controls">
          <button id="e-minus">−</button>
          <span id="e-value">1</span>
          <button id="e-plus">+</button>
        </div>
        <div class="basket-extra" style="display:none;">
          <span style="color:green;">Nombre d'électrons</span> : <span id="e-count-left">1</span>
        </div>
      </div>

    </div>

    <div class="infos">
      <div class="info-grid">
        <div>Élément :</div><div id="elementName">Hydrogène</div>
        <div>Symbole :</div><div><span id="symbol">H</span><sup id="symbol-charge"></sup></div>
        <div id="z-label">Z :</div><div id="z-value"><span id="Z">1</span></div>
        <div id="A-label">A :</div><div id="A-value">1</div>
        <div>État :</div><div id="charge-state">atome</div>
        <div id="isotope-label">Isotope :</div><div id="isotope-state">stable</div>
      </div>
    </div>

  </div>
</div>

<script>
  const elements = {
    1:{name:"Hydrogène",symbol:"H"},
    2:{name:"Hélium",symbol:"He"},
    3:{name:"Lithium",symbol:"Li"},
    4:{name:"Béryllium",symbol:"Be"},
    5:{name:"Bore",symbol:"B"},
    6:{name:"Carbone",symbol:"C"},
    7:{name:"Azote",symbol:"N"},
    8:{name:"Oxygène",symbol:"O"},
    9:{name:"Fluor",symbol:"F"},
    10:{name:"Néon",symbol:"Ne"},
    11:{name:"Sodium",symbol:"Na"},
    12:{name:"Magnésium",symbol:"Mg"},
    13:{name:"Aluminium",symbol:"Al"},
    14:{name:"Silicium",symbol:"Si"},
    15:{name:"Phosphore",symbol:"P"},
    16:{name:"Soufre",symbol:"S"},
    17:{name:"Chlore",symbol:"Cl"},
    18:{name:"Argon",symbol:"Ar"},
    19:{name:"Potassium",symbol:"K"},
    20:{name:"Calcium",symbol:"Ca"}
  };

  // isotope stable par Z
  const stableAByZ = {
    1:1, 2:4, 3:7, 4:9, 5:11,
    6:12, 7:14, 8:16, 9:19, 10:20,
    11:23, 12:24, 13:27, 14:28, 15:31,
    16:32, 17:35, 18:40, 19:39, 20:40
  };

  let protons = 1;
  let neutrons = 0;
  let electrons = 1;
  let showOrbitals = false;
  let showOuter = false;
  let showIsotope = false;
  let nucleusBallsMode = false;

  const electronLayer = document.getElementById("electron-layer");
  const orbitalLayer  = document.getElementById("orbital-layer");
  const toggleOrbitals = document.getElementById("toggle-orbitals");
  const toggleOuter    = document.getElementById("toggle-outer");
  const toggleIsotope  = document.getElementById("toggle-isotope");
  const toggleNucleusMode = document.getElementById("toggle-nucleus-mode");
  const outerToggleWrapper = document.getElementById("outer-toggle-wrapper");

  const shell1 = document.getElementById("shell1");
  const shell2 = document.getElementById("shell2");
  const shell3 = document.getElementById("shell3");

  const outerInfoBox = document.getElementById("outer-info");
  const singleSpan   = document.getElementById("single-count");
  const pairSpan     = document.getElementById("pair-count");
  const outerCompleteSpan = document.getElementById("outer-complete-text");

  const pCore = document.getElementById("p-core");
  const nCore = document.getElementById("n-core");
  const nCoreWrapper = document.getElementById("n-core-wrapper");
  const nucleusEl = document.getElementById("nucleus");
  const nucleusText = document.getElementById("nucleus-text");
  const nucleonLayer = document.getElementById("nucleon-layer");
  const zLabel = document.getElementById("z-label");
  const zValue = document.getElementById("z-value");

  function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

  function distribElectrons(total){
    const caps = [2,8,8];
    const out = [0,0,0];
    let r = total;
    for(let i=0;i<3;i++){
      const take = Math.min(caps[i], r);
      out[i] = take;
      r -= take;
    }
    return out;
  }

  function computeOuterShell(){
    const s = distribElectrons(electrons);
    if(s[2] > 0) return 3;
    if(s[1] > 0) return 2;
    if(s[0] > 0) return 1;
    return 1;
  }

  function highlightOuter(){
    [shell1, shell2, shell3].forEach(sh => sh.classList.remove("highlight"));
    if(!showOuter) return;
    const os = computeOuterShell();
    if(os === 1) shell1.classList.add("highlight");
    else if(os === 2) shell2.classList.add("highlight");
    else shell3.classList.add("highlight");
  }

  // positions des orbitales (carrés)
  function computeOrbitalCenters() {
    const cx = 180, cy = 180;
    const radii = [60,105,150];
    const kClock = [0];
    const lClock = [0,90,180,270];
    const mClock = [0,90,180,270];
    const lists = [kClock,lClock,mClock];

    return lists.map((clockList, shellIndex) => {
      const R = radii[shellIndex];
      return clockList.map(clockDeg => {
        const angleRad = (clockDeg - 90) * Math.PI/180;
        return {
          x: cx + R * Math.cos(angleRad),
          y: cy + R * Math.sin(angleRad)
        };
      });
    });
  }

  const orbitalCenters = computeOrbitalCenters();

  function updateOrbitals() {
    orbitalLayer.innerHTML = "";
    if (!showOrbitals) return;

    const shells = distribElectrons(electrons);

    orbitalCenters.forEach((centers, shellIndex) => {
      if (shells[shellIndex] === 0) return;
      centers.forEach(center => {
        const sq = document.createElement("div");
        sq.className = "orbital-square";
        sq.style.left = (center.x - 14) + "px";
        sq.style.top  = (center.y - 14) + "px";
        orbitalLayer.appendChild(sq);
      });
    });
  }

  function occupancyForShell(count, numOrbitals) {
    const occ = new Array(numOrbitals).fill(0);
    let remaining = count;
    for (let i=0; i<numOrbitals && remaining>0; i++) {
      occ[i]++; remaining--;
    }
    for (let i=0; i<numOrbitals && remaining>0; i++) {
      occ[i]++; remaining--;
    }
    return occ;
  }

  function updateOuterInfo() {
    if (!showOuter) {
      outerInfoBox.style.display = "none";
      return;
    }
    outerInfoBox.style.display = "block";

    const shells = distribElectrons(electrons);
    const outerShell = computeOuterShell();
    const electronsOnOuter = shells[outerShell-1];

    const numOrbitals =
      outerShell === 1 ? orbitalCenters[0].length :
      outerShell === 2 ? orbitalCenters[1].length :
                         orbitalCenters[2].length;

    const occ = occupancyForShell(electronsOnOuter, numOrbitals);
    let singles = 0;
    let pairs   = 0;
    occ.forEach(v => {
      if (v === 1) singles++;
      else if (v === 2) pairs++;
    });

    singleSpan.textContent = singles;
    pairSpan.textContent   = pairs;

    const capacities = [2,8,8];
    const cap = capacities[outerShell-1] || 0;
    const errorSpan = document.getElementById("outer-error-text");
    if (electronsOnOuter === cap && cap>0) {
      const diff = Math.abs(protons - electrons);
      const specialHydride = (protons === 1 && electrons === 2);
      if (diff > 4 || specialHydride) {
        outerCompleteSpan.textContent = "Couche externe complète";
        if (errorSpan) errorSpan.textContent = "mais la structure est fausse";
      } else {
        outerCompleteSpan.textContent = "Couche externe complète, stable";
        if (errorSpan) errorSpan.textContent = "";
      }
    } else {
      outerCompleteSpan.textContent = "";
      if (errorSpan) errorSpan.textContent = "";
    }
  }

  function updateElectrons() {
    electronLayer.innerHTML = "";

    const shells = distribElectrons(electrons);

    if (shell1) shell1.style.display = shells[0] > 0 ? "block" : "none";
    if (shell2) shell2.style.display = shells[1] > 0 ? "block" : "none";
    if (shell3) shell3.style.display = shells[2] > 0 ? "block" : "none";

    const cx = 180, cy = 180;
    const radii = [60,105,150];
    const electronRadius = 5;

    if (showOrbitals) {
      shells.forEach((count, shellIndex) => {
        if (count === 0) return;
        const centers = orbitalCenters[shellIndex];
        const occ = occupancyForShell(count, centers.length);
        occ.forEach((n, orbIndex) => {
          const c = centers[orbIndex];
          for (let k=0;k<n;k++){
            let dx=0, dy=0;
            if (n===2){ dx = (k===0)?-4:4; }
            const e = document.createElement("div");
            e.className = "electron";
            e.style.left = (c.x + dx - electronRadius) + "px";
            e.style.top  = (c.y + dy - electronRadius) + "px";
            electronLayer.appendChild(e);
          }
        });
      });
    } else {
      shells.forEach((count, shellIndex) => {
        if (count === 0) return;
        const R = radii[shellIndex];
        for (let i=0;i<count;i++){
          const fraction = i / count;
          const clockDeg = fraction * 360;
          const ang = (clockDeg - 90) * Math.PI/180;
          const x = cx + R * Math.cos(ang);
          const y = cy + R * Math.sin(ang);
          const e = document.createElement("div");
          e.className = "electron";
          e.style.left = (x - electronRadius) + "px";
          e.style.top  = (y - electronRadius) + "px";
          electronLayer.appendChild(e);
        }
      });
    }
  }

  function updateInfos(){
    const el = elements[protons] || {name:"Inconnu",symbol:"?"};
    document.getElementById("elementName").textContent = el.name;
    document.getElementById("symbol").textContent      = el.symbol;

    const symCharge = document.getElementById("symbol-charge");
    if (symCharge) {
      const diff = Math.abs(protons - electrons);
      if (diff === 0) {
        symCharge.textContent = "";
      } else if (electrons < protons) {
        symCharge.textContent = "+".repeat(diff);
      } else {
        symCharge.textContent = "−".repeat(diff);
      }
    }

    document.getElementById("Z").textContent = protons;

    document.getElementById("p-value").textContent = protons;
    document.getElementById("n-value").textContent = neutrons;
    document.getElementById("e-value").textContent = electrons;

    document.getElementById("p-count-left").textContent = protons;
    document.getElementById("n-count-left").textContent = neutrons;
    document.getElementById("e-count-left").textContent = electrons;

    const A = protons + neutrons;
    document.getElementById("A-value").textContent = A;

    const chargeSpan = document.getElementById("charge-state");
    if (electrons === protons) chargeSpan.textContent = "atome";
    else if (electrons < protons) chargeSpan.textContent = "cation";
    else chargeSpan.textContent = "anion";

    const isotopeSpan = document.getElementById("isotope-state");
    const isoLabel = document.getElementById("isotope-label");
    const aLabel = document.getElementById("A-label");
    const aValue = document.getElementById("A-value");
    if (isoLabel && isotopeSpan) {
      const display = showIsotope ? "block" : "none";
      isoLabel.style.display = display;
      isotopeSpan.style.display = display;
      if (aLabel && aValue) {
        aLabel.style.display = display;
        aValue.style.display = display;
      }
    }

    const neutronBasket = document.getElementById("neutron-basket");
    if (neutronBasket) {
      neutronBasket.style.display = showIsotope ? "block" : "none";
    }

    if (nCoreWrapper) {
      nCoreWrapper.style.display = showIsotope ? "inline" : "none";
    }

    // valeur de l'isotope (stable / instable) si visible
    if (isotopeSpan) {
      const stableA = stableAByZ[protons];
      if (showIsotope && stableA !== undefined && A === stableA) {
        isotopeSpan.textContent = "noyau stable";
      } else if (showIsotope) {
        isotopeSpan.textContent = "noyau peu stable";
      }
    }

    // noyau nombres
    pCore.textContent = protons;
    nCore.textContent = neutrons;

    // vibration du noyau : seulement si l'isotope est affiché ET que le noyau est "peu stable"
    // (si "préférer réduire les animations" est activé, on ne vibre pas)
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (nucleusEl && !reduceMotion && showIsotope) {
      const stableA2 = stableAByZ[protons];
      const isStable = (stableA2 !== undefined && (protons + neutrons) === stableA2);
      nucleusEl.classList.toggle("vibrate", !isStable);
    } else if (nucleusEl) {
      nucleusEl.classList.remove("vibrate");
    }
  }

  function updateNucleusModeUI(){
    if (!nucleusEl || !nucleonLayer || !nucleusText) return;

    if (!nucleusBallsMode) {
      nucleusEl.classList.remove("mode-balls");
      nucleusText.style.display = "block";
      nucleonLayer.style.display = "none";
      if (zLabel) zLabel.style.display = "block";
      if (zValue) zValue.style.display = "block";
      return;
    }

    nucleusEl.classList.add("mode-balls");
    nucleusText.style.display = "none";
    nucleonLayer.style.display = "block";
    if (zLabel) zLabel.style.display = "none";
    if (zValue) zValue.style.display = "none";
  }

  function renderNucleons(){
    if (!nucleusBallsMode || !nucleonLayer) return;
    nucleonLayer.innerHTML = "";

    const total = protons + neutrons;
    if (total <= 0) return;

    // Utiliser les dimensions du noyau (repère local), pas celles de l'atome
    const w = nucleusEl ? (nucleusEl.clientWidth || 96) : 96;
    const h = nucleusEl ? (nucleusEl.clientHeight || 96) : 96;
    const cx = w / 2, cy = h / 2;

    // Paramètres de compacité : noyau très compact (particules très proches, léger recouvrement possible)
    const size = 4;               // diamètre CSS (px) — encore plus petit
    const r = size / 2;           // rayon
    const R = Math.min(w, h) / 2 - r - 6;          // paquet plus concentré
    const minDist = (2 * r) * 0.45;                // ultra-collé (recouvrement visible)

    const placed = [];

    // Biais vers le centre (sqrt) + acceptation progressive si noyau très chargé
    for (let i = 0; i < total; i++) {
      let x = cx, y = cy;
      let found = false;

      for (let tries = 0; tries < 2500; tries++) {
        const ang = Math.random() * Math.PI * 2;
        const rad = (Math.random() ** 2.7) * R; // densité extrême au centre
        const tx = cx + Math.cos(ang) * rad;
        const ty = cy + Math.sin(ang) * rad;

        // collision (léger recouvrement toléré en fin de remplissage)
        let ok = true;
        for (const p of placed) {
          const dx = tx - p.x, dy = ty - p.y;
          if ((dx*dx + dy*dy) < (minDist*minDist)) { ok = false; break; }
        }
        if (ok) { x = tx; y = ty; found = true; break; }
      }

      if (!found) {
        // fallback : on place quand même très près du centre (évite les amas excentrés)
        const ang = Math.random() * Math.PI * 2;
        const rad = Math.random() * (R * 0.25);
        x = cx + Math.cos(ang) * rad;
        y = cy + Math.sin(ang) * rad;
      }

      // petit "squeeze" vers le centre pour un effet plus aggloméré
      x = cx + (x - cx) * 0.60;
      y = cy + (y - cy) * 0.60;
      placed.push({x, y});

      const b = document.createElement("div");
      b.className = "nucleon " + ((i < protons) ? "p" : "n");
      b.style.left = (x - r) + "px";
      b.style.top  = (y - r) + "px";
      nucleonLayer.appendChild(b);
    }
  }

  function updateAll(){
    updateInfos();
    updateElectrons();
    updateOrbitals();
    highlightOuter();
    updateOuterInfo();
    updateNucleusModeUI();
    renderNucleons();
  }


  // --- boutons ---
  document.getElementById("p-minus").onclick = () => {
    protons = clamp(protons-1, 0, 18);
    updateAll();
  };
  document.getElementById("p-plus").onclick = () => {
    protons = clamp(protons+1, 0, 18);
    updateAll();
  };

  document.getElementById("n-minus").onclick = () => {
    neutrons = clamp(neutrons-1, 0, 40);
    updateAll();
  };
  document.getElementById("n-plus").onclick = () => {
    neutrons = clamp(neutrons+1, 0, 40);
    updateAll();
  };

  document.getElementById("e-minus").onclick = () => {
    electrons = clamp(electrons-1, 0, 18);
    updateAll();
  };
  document.getElementById("e-plus").onclick = () => {
    electrons = clamp(electrons+1, 0, 18);
    updateAll();
  };

  toggleOrbitals.onchange = (ev) => {
    showOrbitals = ev.target.checked;
    if (showOrbitals) {
      outerToggleWrapper.style.display = "inline-block";
    } else {
      outerToggleWrapper.style.display = "none";
      showOuter = false;
      toggleOuter.checked = false;
    }
    updateAll();
  };

  toggleOuter.onchange = (ev) => {
    showOuter = ev.target.checked;
    updateAll();
  };

  toggleIsotope.onchange = (ev) => {
    showIsotope = ev.target.checked;
    updateAll();
  };

  if (toggleNucleusMode) {
    toggleNucleusMode.onchange = (ev) => {
      nucleusBallsMode = ev.target.checked;
      updateAll();
    };
  }

  updateAll();
</script>

</body>
</html>
