<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Groupes au hasard</title>
  <style>
    body{
      font-family: system-ui, Segoe UI, Roboto, Arial;
      margin: 24px;
      background: #ffffff;
      color: #111111;
    }
    .wrap{max-width:900px; margin:auto; position:relative}
    h1{font-size:22px; margin:0 0 10px}
    .muted{color:#555; font-size:14px}
    textarea{
      width:100%; min-height:220px; resize:vertical;
      padding:12px; border-radius:8px;
      border:1px solid #ccc;
      background:#fff; color:#111; outline:none;
      font-size:14px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center}
    button{
      padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;
      border:1px solid #2563eb;
      background:#2563eb;
      color:#fff;
    }
    select{
      padding:8px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:14px;
    }
    .pill{
      padding:6px 10px; border-radius:999px;
      border:1px solid #ddd; background:#f9fafb;
      color:#333; font-size:13px
    }
    .out{margin-top:16px; display:grid; gap:12px}
    .group{
      border:1px solid #ddd; background:#fafafa;
      border-radius:10px; padding:12px;
    }
    .group h3{margin:0 0 8px; font-size:15px}
    ul{margin:0; padding-left:18px}
    li{margin:3px 0}

    /* Floating label */
    .label{
      position:absolute;
      top:-10px;
      right:-10px;
      padding:6px 12px;
      border-radius:999px;
      border:2px solid #0f172a;
      background:#ffffff;
      color:#0f172a;
      font-size:12px;
      font-weight:700;
      box-shadow:0 2px 6px rgba(0,0,0,.15);
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="label">Version 1.2<br>S. Ulrich â€” ECG Henryâ€‘Dunant</div>

  <h1>ðŸ‘¥ Groupes au hasard</h1>
  <div class="muted">
    Colle une liste dâ€™Ã©lÃ¨ves (1 par ligne). Seul le premier prÃ©nom est utilisÃ©.
  </div>

  <textarea id="names" placeholder="Jean Dupont&#10;Marie Claire&#10;Lucas"></textarea>

  <div class="row">
    <label>
      Type de groupes :
      <select id="mode">
        <option value="tri">TrinÃ´mes (3)</option>
        <option value="bi">BinÃ´mes (2)</option>
      </select>
    </label>

    <button id="make">Former les groupes</button>
    <span class="pill">Ã‰lÃ¨ves : <b id="count">0</b></span>
  </div>

  <div class="out" id="out"></div>
</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  function parseNames(raw){
    return raw
      .split(/[\n,;\t]+/g)
      .map(s => s.trim())
      .filter(Boolean)
      .map(line => line.split(/\s+/)[0]);
  }

  function randInt(max){
    const c = window.crypto || window.msCrypto;
    if (c && c.getRandomValues) {
      const u = new Uint32Array(1);
      const limit = Math.floor(0xFFFFFFFF / max) * max;
      let x;
      do { c.getRandomValues(u); x = u[0]; } while (x >= limit);
      return x % max;
    }
    return Math.floor(Math.random() * max);
  }

  function shuffle(arr){
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--){
      const j = randInt(i + 1);
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function makeGroups(names, mode){
    const a = shuffle(names);
    const groups = [];

    if (mode === "tri"){
      while (a.length >= 3) groups.push(a.splice(0,3));
      if (a.length === 2) groups.push(a.splice(0,2));
      if (a.length === 1) groups[groups.length - 1].push(a.pop());
    }

    if (mode === "bi"){
      while (a.length >= 2) groups.push(a.splice(0,2));
      if (a.length === 1) groups[groups.length - 1].push(a.pop());
    }

    return groups;
  }

  function render(groups){
    $("out").innerHTML = "";
    groups.forEach((g, i) => {
      const card = document.createElement("div");
      card.className = "group";
      const h = document.createElement("h3");
      h.textContent = `Groupe ${i+1} (${g.length})`;
      const ul = document.createElement("ul");
      g.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        ul.appendChild(li);
      });
      card.appendChild(h);
      card.appendChild(ul);
      $("out").appendChild(card);
    });
  }

  function updateCount(){
    $("count").textContent = parseNames($("names").value).length;
  }

  $("names").addEventListener("input", updateCount);

  $("make").addEventListener("click", () => {
    const names = parseNames($("names").value);
    if (names.length < 2){
      alert("Il faut au moins 2 Ã©lÃ¨ves.");
      return;
    }
    render(makeGroups(names, $("mode").value));
  });

  updateCount();
})();
</script>
</body>
</html>
